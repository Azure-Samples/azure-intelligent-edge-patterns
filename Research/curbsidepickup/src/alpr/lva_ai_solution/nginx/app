server {
    listen 5001;
    server_name _;

    client_max_body_size 2M;
 
    location / {
      include proxy_params;
      proxy_pass http://127.0.0.1:5444;
      proxy_connect_timeout 5000s;
      proxy_read_timeout 5000s;
    }

    location ~ /mjpeg_pub/(\w+)$ {
        nchan_publisher;
        nchan_channel_id $1;
        nchan_channel_group mjpeg;
        nchan_message_buffer_length 5;
        nchan_message_timeout 10s;
    }

    location ~ /mjpeg/(\w+)$ {
        add_header Content-Type "multipart/x-mixed-replace; boundary=--boundary";
        nchan_subscriber http-raw-stream;
        nchan_channel_id $1;
        nchan_channel_group mjpeg;
        nchan_subscriber_first_message newest;
    }

}